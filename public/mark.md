
# Features

## Preliminary values
MACD and the appropriate signal line from the optimized dataset are the first two features added, their periods are in the header just like the default set. Note that they are doubled versions of the default parameters.
* `24-56-MACD` is  EMA 24 days - EMA 56 days
* `18-signal` is an 18 day signal line, calculated as the exponential moving average of aforementioned MACD

### Normalization note
Raw features are basically never going to actually be useful on their own, and if there's something we don't know about a feature that we are expecting a model to pick up on, it would probably take it much longer to find those patterns than we have. It will be more productive to just take the interactions between features like MACD and the supporting signal and drop the original lone data points. We can also blindly mark the interactions of features that don't have human charted meaning, so that common interaction patterns between seemingly arbitrarily correlated variables can still be used to pick up on patterns humans haven't found yet.

## Basic Candlestick Extrapolations
* `relative_open` abs(close - open)
* `relative_high` abs(close - high)
* `relative_low` abs(close - low)
* `heikin_relative_open` `heikin_relative_high` `heikin_relative_low` are generated the same way with their own respective candle values
* `upper_wick` is the height of the upper wick : high - open if open > close else high - close
* `lower_wick` is the height of the lower wick : close - low if open > close else open - low
* `heikin_upper_wick` `heikin_lower_wick` are the same but for heikin

* `high_minus_low` high - low
* `heikin_high_minus_low` same for heikin

* `bullish` is integral boolean if candle is bullish or bearish.
* `heikin_bullish` is the same for the heikin candles.

### Normalization note
**Relative Values**
We determined Z-score doesn't work for these because sign isn't preserved, but sign isn't preserved with these anyway since we're taking their absolute values. So the sign being preserved doesn't really matter for these, the sign just indicates deviation from the mean absolute change, which is still important. If we want sign to be taken into consideration we need different features entirely. We should keep these of course, as the deviation from the mean for each of these values is still significant, however since we aren't considering sign anywhere in the basic candlestick extrapolations I would suggest creating an additional feature set that preserves direction information, but:
* To indicate sign for relative open, we just have to include a bullish indicator. Done
* For relative high and relative low, the sign in relation to close will always be the same: low <= close <= high. So there is not relative sign information here to even preserve. 

So there really is no work to be done here.

I feel really stupid now, because I feel like the reason we were chasing a better normalization strategy for these was because I made a mistake in assuming that it was important to conserve both deviation from the mean and direction in the same feature, it simply isn't. When I said that z-score doesn't work for relative features, I must have forgotten that we're taking the absolute value. Its ok to lose direction here, negative values just means something else here which is fine.

**High - Low**
This is deterministically a relative feature, as (high-low) >= 0. 

## Date Values
* `time_of_day` is a normalized value on the continuous range [0,1]. It is generated by getting the current count of seconds and dividing it by the total seconds for a single day.
* `holiday` is a discrete integral boolean describing if the current time falls on a small list of hollidays. Seeing as most of the volume of Bitcoin is North American in source, I used USA holidays, this can be expanded upon if necessary.
> New Year's Day - 01-01  
> Martin Luther King Jr. Day - 01-16  
> Washington's Birthday (Presidents Day) - 02-20  
> Memorial Day - 5-29  
> Independence Day - 07-04  
> Labor Day - 09-04  
> Columbus Day - 10-09  
> Veterans Day - 11-11  
> Thanksgiving Day - 11-23  
> Christmas Day - 12-25  

* `day_of_week` is a value on the discrete range [0, 6], starting the week on Monday
* `month` is a value on the discrete range [0, 11]

### Normalization note
As long as these are scaled to fit the rest of the data, this is trivial.

## Rate of Change
These are standard point-wise rates of change (slope).
$$\text{current}-\text{previous}$$
* `volume_roc`
* `MACD_roc`
* `MACD_roc_nonstandard` nonstandard refers to the fact that this MACD has periods (24, 56). This is from the "optimized" dataset.
* `EMA200_roc`
* `close_roc`
* `heikin_close_roc`

All of these features are relative point-wise rates of change of their respective source feature. The formula for rate of change used is the one common to financial and technical analysis:
$$\frac{current-previous}{previous}$$
These are a *relative* rate of change, expressable as a percentage.
* `volume_roc_relative`
* `MACD_roc_relative`
* `MACD_roc_nonstandard_relative` nonstandard refers to the fact that this MACD has periods (24, 56). This is from the "optimized" dataset.
* `EMA200_roc_relative`
* `close_roc_relative`
* `heikin_close_roc_relative`

### Normalization note
As I understand it, what we are tying to capture with relative and non relative rates of change is the same thing; the severity of the increase or decrease to a certain extent. A slope change of 0.1 to 5 is significant, but the slope change of 5000 to 6000 really isn't. The difficulty of this feature set is the theoretical limitless upper bound, however the upper bound is filled with outliers, we only care that a rate of change is severely steep is flat or is somewhere in between, preferably while remaining continuous.
We can take the arctangent of the slope $m$ of any time step ($\Delta x=1$) 

$$\theta = \frac{180\times tan^{-1}(m)}{\pi}$$

This limits the feature to a continuous range of (-90, 90), after which scaling is trivial. 
It is important to note that this does make the data nonlinear, as we are taking the arctangent, however we must consider 2 things:
* This clips outliers without removing them, while also preserving sign and relative severity
* LSTMs, as opposed to simpler networks with no gated memory, are actually decent at handling relationships between non linear data points.

I propose we replace relative and non relative first order derivations with their angle on the asymptotic continuous range (-1, 1). 

## Moving Averages
* `volume_EMA` is an exponential moving average of the volume. Period 20 days.
* `ATR` stands for Average True Range, and is a simple moving average of the maximum of three values. Period 14 candles.
$$SMA(max(high-low, |high-\text{previous close}|, |low-\text{previous close}|), period=10)$$
The period chosen here is a default, and is also arbitrary.

### Normalization note

Measuring volatility is important, and ATR may prove useful for this. This is the last thing I still have to work on, first I have to read the GARCH thesis, and then mess around with ATR, STDEV, etc to figure out a workable and interpretable measure of volatility. 
In regard to volume EMA, I feel as though if we dont have a strong belief that this feature correlates with other features, or is interpretable, or is generally useful for it to determine anything about price behavior, we should derive whats actually important about volume and get rid of this extraneous moving average.

## Bollinger
Bollinger bands are used primarily to measure the volatility of a security in the stock market and to identify overbought or oversold conditions. Bollinger Bands consist of three lines:
The Bollinger period used is 30 candles, using a default K value of 2.
* `bollinger_middle` is a simple moving average of the closing price.
* `bollinger_upper` will be higher when prices are more volatile and lower when prices are less volatile. Calculated by adding some k standard deviations of the period onto the middle band line.
* `bollinger_lower` provides a lot of information in conjunction with other features.
    * Potential Oversold Indicator: When the price of a security approaches or goes below the LBB, it may be considered "oversold." In this context, "oversold" doesn't necessarily mean the stock is undervalued, but rather that it has been heavily sold in the recent period compared to its average.
    * Volatility Measurement: The distance between the Upper Bollinger Band (UBB) and the LBB indicates the level of volatility. A wider band suggests higher volatility, while a narrower band indicates lower volatility.
    * Support Level: Some traders view the LBB as a potential support level. If a stock price drops and then rebounds upon nearing the LBB, it might be seen as a sign that this level is acting as support.
    * Break Below LBB: If the stock's price consistently closes below the LBB, it might be interpreted as a strong bearish signal. However, some traders also consider this an extreme oversold condition, anticipating a potential rebound.
    * Squeeze Indicator: If the bands (both UBB and LBB) come close together, it indicates a period of low volatility, known as a "squeeze." This might be a precursor to a period of increased volatility, suggesting a potential breakout (either upward or downward).
* `bollinger_%B` is an indicator derived from Bollinger Bands. It quantifies a security's price relative to the upper and lower Bollinger Band. The main purpose of Bollinger %B is to relate the current price to the price range defined by the Bollinger Bands over a specific period.
$$\frac{close-lower}{upper-lower}$$

### Normalization note
Bollinger data is essentially just a continuous support and resistance measure, we use these to generate other important features down the line, but the efficacy of the raw data points is questionable. At the end of the day they're moving averages. Initially I was under the impression that providing raw features would allow the model to find the information we already know, but I've come to understand that there is no need for that, we can just feed it the important metadata about the raw indicator. Sure there is a change it might find some new pattern, but the interpretability of features like these is so low that it will likely only prove to bloat the training time. I suggest we get rid of the raw features and keep the derivations that follow later in the document.

## Stochastic Oscillator
The Stochastic Oscillator is a momentum indicator that compares a particular closing price of a security to a range of its prices over a certain period of time. It's used to generate overbought and oversold trading signals, utilizing a 0-100 bounded range of values.

The basic idea behind the Stochastic Oscillator is that prices tend to close near the high during upward momentum and near the low during downward momentum.

The Stochastic Oscillator is calculated using the following formulas:

period: 14 days
$$K = (\frac{\text{Current Close}-\text{Lowest Low}}{\text{Highest High}-\text{Lowest Low}}) * 100$$

period: 3 days
$$D = SMA(K, period=3)$$

K crossing above D can be a bullish sign, especially when below 20.
K crossing below D can be a bearish sign, especially when above 80.

Both K and D being above 80 suggests overbought conditions.
Both K and D being below 20 suggests oversold conditions.

Binary Features for Overbought/Oversold Conditions:
* `kd_below_20`: 1 if both K and D are below 20, 0 otherwise.
* `kd_above_80`: 1 if both K and D are above 80, 0 otherwise.
To capture the crossover, you need to compare the current values of K and D with their previous values.
* `kd_cross_up`: 1 if K was below D in the previous time step and is above D in the current time step, 0 otherwise.
* `kd_cross_down`: 1 if K was above D in the previous time step and is below D in the current time step, 0 otherwise.
This captures the significance of crossovers especially when they are in the overbought/oversold regions.
* `kd_cross_up_below_20`: 1 if `kd_cross_up` is 1 and both K and D are below 20, 0 otherwise.
* `kd_cross_down_above_80`: 1 if `kd_cross_down` is 1 and both K and D are above 80, 0 otherwise.

### Normalization note
No note, discrete values with finite cardinality.

## Miscillaneous Derivations
* `MACD_minus_signal`
* `MACD_minus_signal_nonstandard`
* `close_minus_EMA200`

### Normalization note
It may be better to have a simple trigger feature for crossing upward, downward, and coming within a certain threshhold of each other, it rather than the raw distance between two variables, unless we have reasons to believe that the distance has other meaningful value., and if thats the case we may even opt to have a large selection of threshholds instead, as its more interpretable and easier to normalize without loss of information. 

## RSI
The Relative Strength Index (RSI) is a momentum oscillator that measures the speed and change of price movements. The RSI oscillates between 0 and 100 and is typically used to identify overbought or oversold conditions in a traded security. of Period 13 days.
$$RS = \frac{\text{Average gain over x period}}{\text{Average loss over x period}}$$
$$RSI = 100-\frac{100}{1+RS}$$
* `RSI`
* `RSI_above_70` integral boolean indicating overbought conditions
* `RSI_below_30` integral boolean indicating oversold conditions

### Normalization note
No note, RSI is limited from 0 to 100, and the rest are discrete values with finite cardinality.

# Second Round of Features
## Additional MACD Features
* `MACD_sign` : [1, 0] $\in \Z$
* `MACD_sign_nonstandard` : [1, 0] $\in \Z$
* `MACD_minus_signal_sign` : [1, 0] $\in \Z$
* `MACD_minus_signal_sign_nonstandard` : [1, 0] $\in \Z$
* `MACD_cross_over_signal` : [1,0] $\in \Z$, denotes MACD rising above the signal line.
* `MACD_cross_below_signal` : [1,0] $\in \Z$, denotes MACD falling the signal line.
* `MACD_cross_over_signal_nonstandard` : nonstandard parameters of the same standard feature.
* `MACD_cross_below_signal_nonstandard` : nonstandard parameters of the same standard feature.
* `MACD_cross_above_signal_below_0_price_above_EMA200` : [1,0] $\in \Z$, MACD crossing up over the signal line while simultaneously below the 0 line. Only triggers when the candle price is above the 200 EMA.
* `MACD_cross_above_signal_below_0_price_above_EMA200_nonstandard` : nonstandard parameters of the same standard feature.
* `MACD_lower_low` : [1,0] $\in \Z$, triggers when MACD experiences a new lowest valley point within a candle window, I defaulted to 100 due to a lack of guidance. 
* `MACD_lower_low_nonstandard` : nonstandard parameters of the same standard feature
* `MACD_up_EMA200_flat` : [1,0] $\in \Z$, triggers when the MACD rate of change is positive and the 200 EMA is considered flat, may lead to positive price action soon.
* `MACD_up_EMA200_flat_nonstandard` : nonstandard parameters of the same standard feature.

### Normalization note
No note, discrete values with finite cardinality.

## Additional 200 EMA Features 
These features are designed to target the "cross or restest" attribute of bitcoin behavior, where as price reaches the position of the 200 EMA, it will either "retest" or bounce away from it pretty immediately, or cross and continue for a significant distance. The occurance of one of these things is an indicator for short term behavior.
* `EMA200_cross_price` : [1,0] $\in \Z$, triggers when 200 EMA and price cross, either direction.
* `EMA200_bounce` : [1,0] $\in \Z$, Triggers when the distance between the simple moving average and the 200 EMA is below a certain threshhold (which currently is set to around 30), and the sign of the simple moving average flips, indicating that the price is bouncing off the 200 EMA.
* `EMA200_roc_sign` : [1, 0] $\in \Z$
* `EMA200_rising_price_just_above` : [1, 0] $\in \Z$, triggers when the price is hovering just above the 200 EMA, while the 200 EMA is rising. the threshhold for "just above" is currently at 30.
* `EMA200_falling_price_just_below` : [1, 0] $\in \Z$, triggers when the price is hovering just below the 200 EMA, while the 200 EMA is falling. the threshhold for "just below" is currently at 30.

### Normalization note
No note, discrete values with finite cardinality.

## Additional Bollinger Band Features
* `bollinger_bandwidth` : Bollinger upper band - Bollinger lower band.
* `bollinger_bandwidth_roc` : Rate of change of the bandwidth.
* `bollinger_bandwidth_roc_direction` : [1, 0] $\in \Z$, denotes bandwidth growing or shrinking. 

Bollinger Bands can act as a form of continuous support and resistance, leading to the following features being approproate buy and sell signals.
* `bollinger_approach_lower` : [1,0] $\in \Z$, triggers when the price is above the lower band, and is within a threshhold of the band, currently 30. Also triggers when the price is below the lower band.
* `bollinger_approach_upper` :  [1,0] $\in \Z$, triggers when the price is below the upper band, and is within a threshhold of the band, currently 30. Also triggers when the price is above the upper band.
* `bollinger_approach_lower_RSI_below_30` :  [1,0] $\in \Z$, triggers when the two features both trigger.
* `bollinger_approach_upper_RSI_above_70` : [1,0] $\in \Z$, triggers when the two features both trigger.

### Normalization note
No note, discrete values with finite cardinality.


# Normalization notes Summary
## Information Related Directly to Price
These are all relative features or boolean flags. Zscore, while it doesnt work for raw features where direction is preserved through sign, should actually work for these since they are not direction preserving in any way in the first place. Sign being generated for these just has a different meaning, which is fine. 

## Feature Derivatives
Rate of change (at least first order derivatives), can be non-linearly constricted via their angle without significant concern for loss of information or interpretability.

## Raw Data
 Raw features are useless to keep let alone normalize, chart their significant interactions as booleans and then blindly do the same for any 2 given random variables. Interaction patterns that are significant involve the following:
* Two things touch
	* a crosses above b
	* b crosses above a
* Two things get within a reasonable distance from eachother without touching
	* We can have multiple threshholds of distance
	* This goes both ways
		* Threshholds for proximity(1 if within distance, 0 otherwise) which are placed close to a line.
		* Threshholds for departure (0 if within distance, 1 otherwise) which are placed reasonably far away from a line. The logic of including these follows from incredibly wide distances between certain moving averages implying impending extreme absolute price movement 
* Interactions charted should be boolean if possible

## Non EMA data
I also want to consider getting non moving average based data, just to diversify and make sure we have information from different strategies that could interact.


